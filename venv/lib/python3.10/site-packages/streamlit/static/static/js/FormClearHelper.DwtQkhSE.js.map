{"version":3,"file":"FormClearHelper.DwtQkhSE.js","sources":["../../../../lib/src/components/widgets/Form/FormClearHelper.ts"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from \"react\"\n\nimport { SignalConnection } from \"typed-signals\"\n\nimport {\n  isValidFormId,\n  notNullOrUndefined,\n} from \"@streamlit/lib/src/util/utils\"\nimport { WidgetStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\n\nexport class FormClearHelper {\n  private formClearListener?: SignalConnection\n\n  private lastWidgetMgr?: WidgetStateManager\n\n  private lastFormId?: string\n\n  /**\n   * Register the listener that will be called when the widget's form is cleared.\n   * This should be called in the `render` function of every class-based widget\n   * element - it mimics the behavior of a `useEffect` hook, and ensures that\n   * subscription and unsubscription happen correctly.\n   *\n   * Hooks-based widgets can just use `useEffect` and call\n   * `widgetMgr.addFormClearedListener` directly. Or just use the convenient\n   * hook `useFormClearHelper`, below.\n   */\n  public manageFormClearListener(\n    widgetMgr: WidgetStateManager,\n    formId: string,\n    listener: () => void\n  ): void {\n    // If we're already subscribed and our params haven't changed, early-out.\n    if (\n      notNullOrUndefined(this.formClearListener) &&\n      this.lastWidgetMgr === widgetMgr &&\n      this.lastFormId === formId\n    ) {\n      return\n    }\n\n    // Close our previous subscription, if we had one.\n    this.disconnect()\n\n    // If we're not part of a form, there's nothing to do.\n    if (!isValidFormId(formId)) {\n      return\n    }\n\n    // Make the new subscription.\n    this.formClearListener = widgetMgr.addFormClearedListener(formId, listener)\n    this.lastWidgetMgr = widgetMgr\n    this.lastFormId = formId\n  }\n\n  /**\n   * Disconnect from the form-clear signal, if we're connected.\n   * This should be called from the `componentWillUnmount` function of every\n   * element that uses it.\n   */\n  public disconnect(): void {\n    this.formClearListener?.disconnect()\n    this.formClearListener = undefined\n    this.lastWidgetMgr = undefined\n    this.lastFormId = undefined\n  }\n}\n\ninterface FormElementProtoInterface {\n  formId: string\n}\n\ninterface FormClearHelperArgs {\n  element: FormElementProtoInterface\n  widgetMgr: WidgetStateManager\n  onFormCleared: () => void\n}\n\nexport function useFormClearHelper({\n  element,\n  widgetMgr,\n  onFormCleared,\n}: FormClearHelperArgs): void {\n  useEffect(() => {\n    if (!isValidFormId(element.formId)) {\n      return\n    }\n\n    const formClearListener = widgetMgr.addFormClearedListener(\n      element.formId,\n      onFormCleared\n    )\n\n    return () => {\n      formClearListener.disconnect()\n    }\n  }, [element, widgetMgr, onFormCleared])\n}\n"],"names":["FormClearHelper","widgetMgr","formId","listener","notNullOrUndefined","formClearListener","lastWidgetMgr","lastFormId","disconnect","isValidFormId","addFormClearedListener","_a","undefined","useFormClearHelper","element","onFormCleared","useEffect"],"mappings":"uDA0BO,MAAMA,CAAAA,CAiBX,wBACEC,EACAC,EACAC,EACM,CAGJC,EAAmB,KAAKC,iBAAiB,GACzC,KAAKC,gBAAkBL,GACvB,KAAKM,aAAeL,IAMtB,KAAKM,WAAU,EAGVC,EAAcP,CAAS,IAK5B,KAAKG,kBAAoBJ,EAAUS,uBAAuBR,EAAQC,CAAAA,EAClE,KAAKG,cAAgBL,EACrB,KAAKM,WAAaL,GACpB,CAOA,YAA0B,QACxBS,EAAA,KAAKN,oBAAL,MAAAM,EAAwBH,aACxB,KAAKH,kBAAoBO,OACzB,KAAKN,cAAgBM,OACrB,KAAKL,WAAaK,MACpB,CACF,CAYO,SAASC,EAAmB,CACjCC,QAAAA,EACAb,UAAAA,EACAc,cAAAA,GACoB,CACpBC,EAAAA,UAAU,IAAA,CACR,GAAI,CAACP,EAAcK,EAAQZ,MAAM,EAC/B,OAGF,MAAMG,EAAoBJ,EAAUS,uBAClCI,EAAQZ,OACRa,CAAAA,EAGF,MAAO,IAAA,CACLV,EAAkBG,WAAU,CAAA,CAC9B,EACC,CAACM,EAASb,EAAWc,CAAAA,CAAc,CACxC"}